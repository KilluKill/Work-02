<%- include('partials/header', { title: '–î–æ–Ω–∞—Ç-–º–∞–≥–∞–∑–∏–Ω' }) %>

<!-- Shop Header -->
<section class="shop-header bg-gradient-success text-white py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-12">
                <h1 class="display-4 fw-bold mb-3">
                    <i class="fas fa-shopping-cart me-3"></i>–î–æ–Ω–∞—Ç-–º–∞–≥–∞–∑–∏–Ω
                </h1>
                <p class="lead mb-4">
                    –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–ª—É—á–∏—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!
                </p>
                <% if (typeof user !== 'undefined' && user) { %>
                    <div class="user-balance bg-white bg-opacity-20 rounded-3 p-3 d-inline-block">
                        <h5 class="mb-0">
                            <i class="fas fa-wallet me-2"></i>
                            –ë–∞–ª–∞–Ω—Å: <span class="fw-bold"><%= user.balance %>‚ÇΩ</span>
                        </h5>
                    </div>
                <% } else { %>
                    <div class="alert alert-warning d-inline-block">
                        <i class="fas fa-info-circle me-2"></i>
                        <a href="/login" class="text-decoration-none fw-bold">–í–æ–π–¥–∏—Ç–µ</a> –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>

<!-- Categories Navigation -->
<section class="categories-nav bg-light py-3 sticky-top">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-pills justify-content-center" id="shop-categories">
                    <li class="nav-item">
                        <a class="nav-link active" href="#ranks" data-bs-toggle="pill">
                            <i class="fas fa-crown me-2"></i>VIP –°—Ç–∞—Ç—É—Å—ã
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#currency" data-bs-toggle="pill">
                            <i class="fas fa-coins me-2"></i>–í–∞–ª—é—Ç–∞
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#cases" data-bs-toggle="pill">
                            <i class="fas fa-gift me-2"></i>–ö–µ–π—Å—ã
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#privileges" data-bs-toggle="pill">
                            <i class="fas fa-star me-2"></i>–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#other" data-bs-toggle="pill">
                            <i class="fas fa-box me-2"></i>–†–∞–∑–Ω–æ–µ
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- Shop Content -->
<section class="shop-content py-5">
    <div class="container">
        <div class="tab-content" id="shop-content">
            
            <!-- VIP Ranks -->
            <div class="tab-pane fade show active" id="ranks">
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold mb-3">üëë VIP –°—Ç–∞—Ç—É—Å—ã</h2>
                        <p class="text-muted">–ü–æ–ª—É—á–∏—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</p>
                    </div>
                </div>
                
                <div class="row g-4">
                    <% categories.rank.forEach(item => { %>
                        <div class="col-lg-4 col-md-6">
                            <div class="product-card h-100 border rounded-3 shadow-sm position-relative overflow-hidden">
                                <% if (item.name.includes('Elite')) { %>
                                    <div class="ribbon bg-danger text-white">–ü–û–ü–£–õ–Ø–†–ù–û</div>
                                <% } %>
                                
                                <div class="product-header bg-warning text-dark p-4 text-center">
                                    <i class="fas fa-crown fa-3x mb-3"></i>
                                    <h4 class="fw-bold mb-2"><%= item.name %></h4>
                                    <p class="mb-0 opacity-75">30 –¥–Ω–µ–π –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π</p>
                                </div>
                                
                                <div class="product-body p-4">
                                    <p class="text-muted mb-3"><%= item.description %></p>
                                    
                                    <div class="features mb-4">
                                        <h6 class="fw-bold mb-2">–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:</h6>
                                        <ul class="list-unstyled">
                                            <% if (item.name.includes('VIP')) { %>
                                                <li><i class="fas fa-check text-success me-2"></i>–ü–æ–ª–µ—Ç –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–∏</li>
                                                <li><i class="fas fa-check text-success me-2"></i>5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–æ–º–æ–≤</li>
                                                <li><i class="fas fa-check text-success me-2"></i>VIP —á–∞—Ç –∏ —Ü–≤–µ—Ç –Ω–∏–∫–∞</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤—Ö–æ–¥</li>
                                            <% } else if (item.name.includes('Premium')) { %>
                                                <li><i class="fas fa-check text-success me-2"></i>–í—Å–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ VIP</li>
                                                <li><i class="fas fa-check text-success me-2"></i>10 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–æ–º–æ–≤</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–ö–æ–º–∞–Ω–¥–∞ /god</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–î–æ—Å—Ç—É–ø –∫ /kit premium</li>
                                            <% } else if (item.name.includes('Elite')) { %>
                                                <li><i class="fas fa-check text-success me-2"></i>–í—Å–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ Premium</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –¥–æ–º–∞</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–ö–æ–º–∞–Ω–¥—ã /tp –∏ /tphere</li>
                                                <li><i class="fas fa-check text-success me-2"></i>–î–æ—Å—Ç—É–ø –∫ –∫—Ä–µ–∞—Ç–∏–≤—É</li>
                                            <% } %>
                                        </ul>
                                    </div>
                                    
                                    <div class="price-section text-center">
                                        <div class="price mb-3">
                                            <span class="h3 fw-bold text-warning"><%= item.price %>‚ÇΩ</span>
                                            <small class="text-muted d-block">–∑–∞ 30 –¥–Ω–µ–π</small>
                                        </div>
                                        
                                        <% if (typeof user !== 'undefined' && user) { %>
                                            <button class="btn btn-warning btn-lg w-100" onclick="purchaseItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>)">
                                                <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏—Ç—å
                                            </button>
                                        <% } else { %>
                                            <a href="/login" class="btn btn-outline-warning btn-lg w-100">
                                                <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
                                            </a>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
            
            <!-- Currency -->
            <div class="tab-pane fade" id="currency">
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold mb-3">üí∞ –ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</h2>
                        <p class="text-muted">–ü–æ–∫—É–ø–∞–π—Ç–µ –º–æ–Ω–µ—Ç—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –ø–æ–∫—É–ø–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</p>
                    </div>
                </div>
                
                <div class="row g-4">
                    <% categories.currency.forEach(item => { %>
                        <div class="col-lg-3 col-md-6">
                            <div class="product-card h-100 border rounded-3 shadow-sm text-center">
                                <div class="product-header bg-success text-white p-4">
                                    <i class="fas fa-coins fa-3x mb-3"></i>
                                    <h5 class="fw-bold mb-0"><%= item.name %></h5>
                                </div>
                                
                                <div class="product-body p-4">
                                    <p class="text-muted mb-3"><%= item.description %></p>
                                    
                                    <div class="price mb-3">
                                        <span class="h4 fw-bold text-success"><%= item.price %>‚ÇΩ</span>
                                    </div>
                                    
                                    <% if (typeof user !== 'undefined' && user) { %>
                                        <button class="btn btn-success w-100" onclick="purchaseItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>)">
                                            <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏—Ç—å
                                        </button>
                                    <% } else { %>
                                        <a href="/login" class="btn btn-outline-success w-100">
                                            <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
            
            <!-- Cases -->
            <div class="tab-pane fade" id="cases">
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold mb-3">üéÅ –î–æ–Ω–∞—Ç –∫–µ–π—Å—ã</h2>
                        <p class="text-muted">–û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</p>
                    </div>
                </div>
                
                <div class="row g-4">
                    <% categories.case.forEach(item => { %>
                        <div class="col-lg-4 col-md-6">
                            <div class="product-card h-100 border rounded-3 shadow-sm text-center">
                                <div class="product-header bg-info text-white p-4">
                                    <i class="fas fa-gift fa-3x mb-3"></i>
                                    <h5 class="fw-bold mb-0"><%= item.name %></h5>
                                </div>
                                
                                <div class="product-body p-4">
                                    <p class="text-muted mb-3"><%= item.description %></p>
                                    
                                    <div class="case-contents mb-3">
                                        <h6 class="fw-bold mb-2">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</h6>
                                        <ul class="list-unstyled small">
                                            <li><i class="fas fa-gem text-primary me-2"></i>–ê–ª–º–∞–∑—ã (32-64 —à—Ç.)</li>
                                            <li><i class="fas fa-coins text-warning me-2"></i>–ú–æ–Ω–µ—Ç—ã (500-2000)</li>
                                            <li><i class="fas fa-magic text-purple me-2"></i>–ó–∞—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</li>
                                            <li><i class="fas fa-star text-success me-2"></i>–†–µ–¥–∫–∏–µ –±–ª–æ–∫–∏</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="price mb-3">
                                        <span class="h4 fw-bold text-info"><%= item.price %>‚ÇΩ</span>
                                    </div>
                                    
                                    <% if (typeof user !== 'undefined' && user) { %>
                                        <button class="btn btn-info w-100" onclick="purchaseItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>)">
                                            <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏—Ç—å –∫–µ–π—Å
                                        </button>
                                    <% } else { %>
                                        <a href="/login" class="btn btn-outline-info w-100">
                                            <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
            
            <!-- Privileges -->
            <div class="tab-pane fade" id="privileges">
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold mb-3">‚≠ê –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏</h2>
                        <p class="text-muted">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫–æ–º–∞–Ω–¥—ã</p>
                    </div>
                </div>
                
                <div class="row g-4">
                    <% categories.privilege.forEach(item => { %>
                        <div class="col-lg-6 col-md-6">
                            <div class="product-card h-100 border rounded-3 shadow-sm">
                                <div class="product-header bg-primary text-white p-4">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <i class="fas fa-star fa-2x"></i>
                                        </div>
                                        <div class="col">
                                            <h5 class="fw-bold mb-1"><%= item.name %></h5>
                                            <small class="opacity-75">–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="product-body p-4">
                                    <p class="text-muted mb-3"><%= item.description %></p>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="h4 fw-bold text-primary mb-0"><%= item.price %>‚ÇΩ</span>
                                        
                                        <% if (typeof user !== 'undefined' && user) { %>
                                            <button class="btn btn-primary" onclick="purchaseItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>)">
                                                <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏—Ç—å
                                            </button>
                                        <% } else { %>
                                            <a href="/login" class="btn btn-outline-primary">
                                                <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏
                                            </a>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
            
            <!-- Other -->
            <div class="tab-pane fade" id="other">
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold mb-3">üì¶ –†–∞–∑–Ω–æ–µ</h2>
                        <p class="text-muted">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏</p>
                    </div>
                </div>
                
                <div class="row g-4">
                    <% categories.other.forEach(item => { %>
                        <div class="col-lg-4 col-md-6">
                            <div class="product-card h-100 border rounded-3 shadow-sm text-center">
                                <div class="product-header bg-secondary text-white p-4">
                                    <i class="fas fa-box fa-3x mb-3"></i>
                                    <h5 class="fw-bold mb-0"><%= item.name %></h5>
                                </div>
                                
                                <div class="product-body p-4">
                                    <p class="text-muted mb-3"><%= item.description %></p>
                                    
                                    <div class="price mb-3">
                                        <span class="h4 fw-bold text-secondary"><%= item.price %>‚ÇΩ</span>
                                    </div>
                                    
                                    <% if (typeof user !== 'undefined' && user) { %>
                                        <button class="btn btn-secondary w-100" onclick="purchaseItem(<%= item.id %>, '<%= item.name %>', <%= item.price %>)">
                                            <i class="fas fa-shopping-cart me-2"></i>–ö—É–ø–∏—Ç—å
                                        </button>
                                    <% } else { %>
                                        <a href="/login" class="btn btn-outline-secondary w-100">
                                            <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Payment Methods -->
<section class="payment-methods bg-light py-5">
    <div class="container">
        <div class="row text-center mb-4">
            <div class="col-12">
                <h3 class="fw-bold mb-3">üí≥ –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</h3>
                <p class="text-muted">–ú—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</p>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-auto">
                <div class="payment-icons d-flex gap-3">
                    <div class="payment-icon bg-white p-3 rounded shadow-sm">
                        <i class="fab fa-cc-visa fa-2x text-primary"></i>
                    </div>
                    <div class="payment-icon bg-white p-3 rounded shadow-sm">
                        <i class="fab fa-cc-mastercard fa-2x text-danger"></i>
                    </div>
                    <div class="payment-icon bg-white p-3 rounded shadow-sm">
                        <i class="fab fa-paypal fa-2x text-info"></i>
                    </div>
                    <div class="payment-icon bg-white p-3 rounded shadow-sm">
                        <i class="fas fa-mobile-alt fa-2x text-success"></i>
                    </div>
                    <div class="payment-icon bg-white p-3 rounded shadow-sm">
                        <i class="fas fa-university fa-2x text-warning"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Purchase Modal -->
<div class="modal fade" id="purchaseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-shopping-cart me-2"></i>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="purchase-details">
                    <h6>–¢–æ–≤–∞—Ä: <span id="purchase-item-name"></span></h6>
                    <h6>–¶–µ–Ω–∞: <span id="purchase-item-price"></span>‚ÇΩ</h6>
                    <hr>
                    <div class="form-group mb-3">
                        <label for="payment-method" class="form-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
                        <select class="form-select" id="payment-method">
                            <option value="card">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
                            <option value="paypal">PayPal</option>
                            <option value="qiwi">QIWI</option>
                            <option value="yandex">–Ø–Ω–¥–µ–∫—Å.–î–µ–Ω—å–≥–∏</option>
                        </select>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" id="confirm-purchase">
                    <i class="fas fa-credit-card me-2"></i>–û–ø–ª–∞—Ç–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.shop-header {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.ribbon {
    position: absolute;
    top: 15px;
    right: -30px;
    padding: 5px 40px;
    font-size: 12px;
    font-weight: bold;
    transform: rotate(45deg);
    z-index: 10;
}

.product-card:hover {
    transform: translateY(-5px);
    transition: transform 0.3s ease;
}

.payment-icon:hover {
    transform: translateY(-3px);
    transition: transform 0.3s ease;
}

.text-purple {
    color: #6f42c1 !important;
}

.nav-pills .nav-link {
    border-radius: 20px;
    margin: 0 5px;
}

.nav-pills .nav-link.active {
    background-color: #0d6efd;
}
</style>

<script>
let currentItemId = null;

function purchaseItem(itemId, itemName, itemPrice) {
    currentItemId = itemId;
    document.getElementById('purchase-item-name').textContent = itemName;
    document.getElementById('purchase-item-price').textContent = itemPrice;
    
    const modal = new bootstrap.Modal(document.getElementById('purchaseModal'));
    modal.show();
}

document.getElementById('confirm-purchase').addEventListener('click', function() {
    if (!currentItemId) return;
    
    const paymentMethod = document.getElementById('payment-method').value;
    
    fetch('/purchase', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            item_id: currentItemId,
            payment_method: paymentMethod
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(data.message, 'success');
            bootstrap.Modal.getInstance(document.getElementById('purchaseModal')).hide();
        } else {
            showToast(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–∫—É–ø–∫–∏', 'error');
    });
});
</script>

<%- include('partials/footer') %>